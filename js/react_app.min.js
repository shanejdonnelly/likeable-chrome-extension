"use strict";var DateTimePicker=React.createClass({displayName:"DateTimePicker",componentDidMount:function(){var _this=this;this.props.showhide_browser&&(this.calendar=new Pikaday({container:document.getElementById("js-pikaday-container"),minDate:new Date,onSelect:function(){_this.setDate($("#js-datepicker").val())},field:document.getElementById("js-datepicker"),keepOpen:!0,trigger:document.getElementById("js-datepicker-trigger"),defaultDate:_this.props.moment.toDate(),setDefaultDate:!0}),this.calendar.show())},componentWillReceiveProps:function(){this.calendar.setMoment(this.props.moment,!0)},handleNativeDateChange:function(e){this.setDate(e.target.value)},handleNativeTimeChange:function(e){this.setNativeTime(e.target.value)},handleTimeChange:function(ampm,hours,minutes){var _this=this,hours="PM"===ampm?hours+12:hours,time=_this.props.moment;time.hours(hours),time.minutes(minutes)},hide:function(){$("body").trigger("toggleDatepicker")},setDate:function(date){var _this=this,new_date=_this.props.moment,date_array=date.split("-"),month=parseInt(date_array[1])-1;new_date.year(date_array[0]),new_date.month(month),new_date.date(date_array[2]),$("body").trigger("dateChange",[new_date])},setNativeTime:function(time){var _this=this,new_time=_this.props.moment,time_array=time.split(":");new_time.hour(time_array[0]),new_time.minute(time_array[1]),$("body").trigger("dateChange",[new_time])},render:function(){var _this=this;return React.createElement("div",null,React.createElement("div",{className:"m-datepicker "+this.props.showhide_browser},React.createElement("input",{className:"hidden",id:"js-datepicker"}),React.createElement("div",{id:"js-pikaday-container"}),React.createElement(TimePicker,{moment:this.props.moment,show:this.props.showhide_browser,onchange:_this.handleTimeChange})),React.createElement("div",{className:"m-datepicker m-datepicker-native "+this.props.showhide_native},React.createElement("span",{className:"m-datepicker__close-btn",onClick:this.hide},"×"),React.createElement("input",{type:"date",className:"m-datepicker__native-input",value:this.props.moment.format("YYYY-MM-DD"),onChange:this.handleNativeDateChange}),React.createElement("input",{type:"time",className:"m-datepicker__native-input",value:this.props.moment.format("HH:mm"),onChange:this.handleNativeTimeChange})))}}),TimePicker=React.createClass({displayName:"TimePicker",getDefaultProps:function(){return{show:"hidden"}},getInitialState:function(){return{datetime:this.props.moment,hours:this.props.moment.hour(),minutes:this.props.moment.minute(),ampm:this.props.moment.hour()>11?"PM":"AM"}},handleAMPMChange:function(e){this.setTime(e,"ampm")},handleHoursChange:function(e){this.setTime(e,"hours")},handleMinutesChange:function(e){this.setTime(e,"minutes")},setTime:function(e,type){var _this=this,datetime=_this.props.moment;if("hours"===type){var ampm=datetime.hours()<12?"AM":"PM",adjusted_hours="PM"===ampm?parseInt(e.target.value)+12:e.target.value;datetime.hours(adjusted_hours)}else if("minutes"===type)datetime.minutes(e.target.value);else if("ampm"===type){var hours=_this.props.moment.hour(),old_value=12>hours?"AM":"PM";"AM"===e.target.value&&"PM"===old_value?datetime.hours(hours-12):"PM"===e.target.value&&"AM"===old_value&&datetime.hours(hours+12)}$("body").trigger("dateChange",[datetime])},render:function(){var _this=this,hours=_this.props.moment.hour(),ampm=12>hours?"AM":"PM",adjusted_hours=hours>11?hours-12:hours;return React.createElement("div",{className:"m-datepicker__timepicker "+_this.props.show},React.createElement("select",{className:"",value:adjusted_hours,onChange:_this.handleHoursChange},React.createElement("option",{value:"0"},"12"),React.createElement("option",{value:"1"},"1"),React.createElement("option",{value:"2"},"2"),React.createElement("option",{value:"3"},"3"),React.createElement("option",{value:"4"},"4"),React.createElement("option",{value:"5"},"5"),React.createElement("option",{value:"6"},"6"),React.createElement("option",{value:"7"},"7"),React.createElement("option",{value:"8"},"8"),React.createElement("option",{value:"9"},"9"),React.createElement("option",{value:"10"},"10"),React.createElement("option",{value:"11"},"11")),React.createElement("select",{className:"",value:_this.props.moment.minute(),onChange:_this.handleMinutesChange},React.createElement("option",{value:"0"},"00"),React.createElement("option",{value:"1"},"01"),React.createElement("option",{value:"2"},"02"),React.createElement("option",{value:"3"},"03"),React.createElement("option",{value:"4"},"04"),React.createElement("option",{value:"5"},"05"),React.createElement("option",{value:"6"},"06"),React.createElement("option",{value:"7"},"07"),React.createElement("option",{value:"8"},"08"),React.createElement("option",{value:"9"},"09"),React.createElement("option",{value:"10"},"10"),React.createElement("option",{value:"11"},"11"),React.createElement("option",{value:"12"},"12"),React.createElement("option",{value:"13"},"13"),React.createElement("option",{value:"14"},"14"),React.createElement("option",{value:"15"},"15"),React.createElement("option",{value:"16"},"16"),React.createElement("option",{value:"17"},"17"),React.createElement("option",{value:"18"},"18"),React.createElement("option",{value:"19"},"19"),React.createElement("option",{value:"20"},"20"),React.createElement("option",{value:"21"},"21"),React.createElement("option",{value:"22"},"22"),React.createElement("option",{value:"23"},"23"),React.createElement("option",{value:"24"},"24"),React.createElement("option",{value:"25"},"25"),React.createElement("option",{value:"26"},"26"),React.createElement("option",{value:"27"},"27"),React.createElement("option",{value:"28"},"28"),React.createElement("option",{value:"29"},"29"),React.createElement("option",{value:"30"},"30"),React.createElement("option",{value:"31"},"31"),React.createElement("option",{value:"32"},"32"),React.createElement("option",{value:"33"},"33"),React.createElement("option",{value:"34"},"34"),React.createElement("option",{value:"35"},"35"),React.createElement("option",{value:"36"},"36"),React.createElement("option",{value:"37"},"37"),React.createElement("option",{value:"38"},"38"),React.createElement("option",{value:"39"},"39"),React.createElement("option",{value:"40"},"40"),React.createElement("option",{value:"41"},"41"),React.createElement("option",{value:"42"},"42"),React.createElement("option",{value:"43"},"43"),React.createElement("option",{value:"44"},"44"),React.createElement("option",{value:"45"},"45"),React.createElement("option",{value:"46"},"46"),React.createElement("option",{value:"47"},"47"),React.createElement("option",{value:"48"},"48"),React.createElement("option",{value:"49"},"49"),React.createElement("option",{value:"50"},"50"),React.createElement("option",{value:"51"},"51"),React.createElement("option",{value:"52"},"52"),React.createElement("option",{value:"53"},"53"),React.createElement("option",{value:"54"},"54"),React.createElement("option",{value:"55"},"55"),React.createElement("option",{value:"56"},"56"),React.createElement("option",{value:"57"},"57"),React.createElement("option",{value:"58"},"58"),React.createElement("option",{value:"59"},"59")),React.createElement("select",{className:"",value:ampm,onChange:_this.handleAMPMChange},React.createElement("option",{value:"AM"},"AM"),React.createElement("option",{value:"PM"},"PM")))}}),AccountsScreen=React.createClass({displayName:"AccountsScreen",handleBackBtnClick:function(){this.props.close()},toggleAccount:function(platform,platform_id,selected){var _this=this;selected?$(".js-composebox").trigger("addAccount",[platform_id]):_this.props.posts.length>1&&$(".js-composebox").trigger("removeAccount",[platform_id]);var remove_safely=!0;selected||1!=_this.props.posts.length||(remove_safely=!1),!_this.props.edit_mode&&remove_safely&&$.ajax({type:"POST",url:"/toggle_social_account_active",data:JSON.stringify({platform:platform,platform_id:platform_id,selected:selected?1:0}),contentType:"application/json",success:function(){console.log("changed social account defaults")},error:function(){console.log("someting went wrong")}})},render:function(){var _this=this,list=[];return this.props.accounts.forEach(function(acct,index){var checked="",selected=!1;_this.props.posts.forEach(function(post){post.platform_id===acct.platform_id&&(checked="checked",selected=!0)}),list.push(React.createElement("div",{className:"m-accounts-screen__row",onClick:_this.toggleAccount.bind(_this,acct.platform,acct.platform_id,!selected)},React.createElement(Avatar,{platform:acct.platform,platform_id:acct.platform_id,avatar_url:acct.avatar_url,key:index}),React.createElement("div",{className:"m-accounts-screen__text"},React.createElement("span",{className:"m-accounts-screen__name"},acct.username),React.createElement("span",{className:"m-accounts-screen__platform"},acct.platform)),React.createElement("input",{id:"input_"+index,type:"checkbox",checked:checked,className:"m-accounts-screen__checkbox",onChange:_this.handleCheckboxChange}),React.createElement("label",{"for":"input_"+index})))}),React.createElement("div",{className:"m-accounts-screen "+this.props.show},React.createElement("div",{className:"m-composebox__header"},React.createElement("div",{className:"m-composebox__top-row m-composebox__row"},React.createElement("i",{className:"fa fa-arrow-left m-accounts-screen__back-btn",onClick:this.handleBackBtnClick}),React.createElement("span",{className:"m-composebox__heading"},"Select Accounts"),React.createElement("span",{className:"m-accounts-screen__done-btn btn btn-round",onClick:this.handleBackBtnClick},"Save"))),React.createElement("div",{className:"m-accounts-screen__row-wrap"},list))}}),Avatar=React.createClass({displayName:"Avatar",handleClick:function(e){var _this=this;$("body").trigger("setActiveAcct",[_this.props.platform_id])},render:function(){var platform=this.props.platform?this.props.platform:"",background_class="";"undefined"!=typeof this.props.avatar_url&&this.props.avatar_url||(background_class=-1!==platform.indexOf("Facebook")?"fa fa-facebook m-social-icon facebook-icon avatar-icon":"Twitter"===platform?"fa fa-twitter m-social-icon twitter-icon avatar-icon":"LinkedIn"===platform?"fa fa-linkedin m-social-icon linkedin-icon avatar-icon":"fa fa-flag m-social-icon avatar-icon likeable-icon");var style=this.props.avatar_url?{backgroundImage:"url("+this.props.avatar_url+")"}:{},selected=this.props.selected?"selected":"";return React.createElement("span",{className:"m-avatar "+selected+" "+background_class,style:style,onClick:this.handleClick})}}),EzModal=React.createClass({displayName:"EzModal",clickCloseBtn:function(){this.closeModal()},closeModal:function(){$(this.props.el).trigger("closeModal")},render:function(){var show_style=this.props.show?{display:"block"}:{display:"none"},content=[];return this.props.image_url&&content.push(React.createElement("img",{className:"m-post__image-modal",src:this.props.image_url})),this.props.text,React.createElement("div",{className:"m-ezmodal",style:show_style},React.createElement("span",{className:"m-ezmodal__close-btn",onClick:this.clickCloseBtn},"×"),content)}}),Pagination=React.createClass({displayName:"Pagination",gotoPage:function(i){this.props.$el.trigger("loadpage",[i-1])},loadFirst:function(){this.gotoPage(1)},loadLast:function(){this.gotoPage(this.props.numpages)},loadNext:function(){this.props.$el.trigger("loadnext")},loadPrev:function(){this.props.$el.trigger("loadprev")},pagesToShow:function(){for(var pages=[],begin_at=this.props.current_page-2<=0?1:this.props.current_page-2,i=begin_at;begin_at+4>=i;i++)i>this.props.numpages||(i===this.props.current_page?pages.push(React.createElement("b",{className:"m-pagination__page-btn"},i)):pages.push(React.createElement("span",{className:"m-pagination__page-btn",onClick:this.gotoPage.bind(this,i)},i)));return pages},render:function(){var pages=this.pagesToShow();return React.createElement("div",{className:"m-pagination"},this.props.offset>0?React.createElement("span",{className:"m-pagination__page-btn",onClick:this.loadFirst},"<<"):null,this.props.offset>0?React.createElement("span",{className:"m-pagination__page-btn",onClick:this.loadPrev},"<"):null,pages,this.props.offset!==this.props.numpages-1?React.createElement("span",{className:"m-pagination__page-btn",onClick:this.loadNext},">"):null,this.props.offset!==this.props.numpages-1?React.createElement("span",{className:"m-pagination__page-btn",onClick:this.loadLast},">>"):null)}}),PostLink=React.createClass({displayName:"PostLink",render:function(){var props=this.props,platform_icon=[],text=[];return-1!==props.platform.indexOf("Facebook")?""!==props.error?platform_icon.push(React.createElement("i",{className:"fa fa-facebook m-social-icon error-icon small-icon"})):platform_icon.push(React.createElement("a",{target:"_blank",className:"",href:props.url},React.createElement("i",{className:"fa fa-facebook m-social-icon facebook-icon small-icon"}))):-1!==props.platform.indexOf("Twitter")?""!==props.error?platform_icon.push(React.createElement("i",{className:"fa fa-twitter m-social-icon error-icon small-icon"})):platform_icon.push(React.createElement("a",{target:"_blank",className:"",href:props.url},React.createElement("i",{className:"fa fa-twitter m-social-icon twitter-icon small-icon"}))):-1!==props.platform.indexOf("Linked")&&(""!==props.error?platform_icon.push(React.createElement("i",{className:"fa fa-linkedin m-social-icon error-icon small-icon"})):platform_icon.push(React.createElement("a",{target:"_blank",className:"",href:props.url},React.createElement("i",{className:"fa fa-linkedin m-social-icon linkedin-icon small-icon"})))),""!==props.error?text.push(React.createElement("span",{className:"m-list__error"},"Error: ",props.link_name)):text.push(React.createElement("a",{target:"_blank",className:"m-list__link",href:props.url},props.link_name)),React.createElement("div",{className:"m-list clear"},React.createElement("span",{className:"m-list__name"},platform_icon,text))}}),PostSearch=React.createClass({displayName:"PostSearch",getInitialState:function(){return{show_clear_btn:!1}},clearSearch:function(){this.props.$el.trigger("clearsearch"),$(".js-search-field").val(""),this.setState({show_clear_btn:!1})},handleKeyDown:function(e){13===e.keyCode&&this.search(e)},search:function search(){var search_term=$(".js-search-field").val(),search=encodeURIComponent(search_term);search_term.length>2&&(this.setState({show_clear_btn:!0}),this.props.$el.trigger("search",search))},render:function(){var clear_btn=this.state.show_clear_btn?React.createElement("i",{className:"m-post-search__clear-btn fa fa-times js-search-clear-btn",onClick:this.clearSearch}):null;return React.createElement("div",{className:"m-post-search"},React.createElement("i",{className:"m-post-search__icon fa fa-search",onClick:this.search}),React.createElement("input",{className:"m-post-search__input js-search-field",placeholder:"Search...",onKeyDown:this.handleKeyDown}),clear_btn)}}),Post=React.createClass({displayName:"Post",componentDidMount:function(){this.listen()},getInitialState:function(){return{show_image_modal:!1,show_error_message:!1,error_message:""}},listen:function(){var _this=this;$(".js-post").on("closeModal",function(){_this.setState({show_image_modal:!1})})},imageClick:function(){this.setState({show_image_modal:!0})},repost:function(){$("body").trigger("ideaPost",[this.props.post_details.message,this.props.post_details.image_url])},showErrorModal:function(index){this.setState({show_error_message:!0,error_message:this.props.links[index].error})},render:function(){var buttons=[],platforms=[],links=[],image_thumb=[];if(""===this.props.post_details.image_url||"undefined"==typeof this.props.post_details.image_url?image_thumb=null:image_thumb.push(React.createElement("img",{className:"m-post-summary__thumbnail",src:this.props.post_details.image_url,onClick:this.imageClick})),"archive"===this.props.post_type){if(buttons.push(React.createElement("i",{className:"btn btn-reuse fa fa-refresh",onClick:this.repost})),this.props.links&&this.props.links.length>0)for(var i=0;i<this.props.links.length;i++){var link=this.props.links[i];links.push(React.createElement(PostLink,{error:link.error,url:link.url,platform:link.link_platform,link_name:link.link_name}))}}else buttons.push(React.createElement("i",{className:"btn btn-delete fa fa-times"})),buttons.push(React.createElement("i",{className:"btn btn-edit fa fa-pencil"}));return this.props.post_platforms.twitter&&platforms.push(React.createElement("i",{className:"m-post-summary__platform-icon fa fa-twitter-square"})),this.props.post_platforms.facebook&&platforms.push(React.createElement("i",{className:"m-post-summary__platform-icon fa fa-facebook-square"})),this.props.post_platforms.linkedin&&platforms.push(React.createElement("i",{className:"m-post-summary__platform-icon fa fa-linkedin-square"})),React.createElement("div",{className:"m-post-summary clearfix js-post"},React.createElement("div",{className:"m-post-summary__btn-wrap"},buttons),React.createElement("div",{className:"m-post-summary__date-wrap"},React.createElement("span",{className:"m-post-summary__date"},this.props.post_details.day),React.createElement("span",{className:"m-post-summary__date"},this.props.post_details.date),React.createElement("span",{className:"m-post-summary__date"},"at ",this.props.post_details.time),React.createElement("div",{className:"m-post-summary__networks"},"archive"===this.props.post_type?null:platforms)),React.createElement("div",{className:"m-post-summary__content"},image_thumb,React.createElement(EzModal,{el:".js-post",image_url:this.props.post_details.image_url,show:this.state.show_image_modal}),React.createElement("div",{className:"m-post-summary__message"},this.props.post_details.message),React.createElement("span",{className:"clear left mt10"},"Posted to:"),links))}}),ArchivedPosts=React.createClass({displayName:"ArchivedPosts",componentDidMount:function(){this.$el=$(".js-past-post-wrap"),this.getPosts(),this.listen()},getInitialState:function(){return{posts:[],loading:!0,offset:0,numposts:0,limit:10,search:""}},getPosts:function(limit,offset,search){var _this=this;limit="undefined"==typeof limit||null===limit?"?limit="+this.state.limit:"?limit="+limit,offset="undefined"==typeof offset||null===offset?"&offset="+this.state.offset*this.state.limit:"&offset="+offset*this.state.limit,search="undefined"==typeof search||null===search?"&search="+this.state.search:"&search="+search,_this.setState({loading:!0}),$.get("archive.json"+limit+offset+search,function(data){_this.parsePostData(data.posts),_this.setState({loading:!1,numposts:data.numposts})})},listen:function(){var _this=this;this.$el.on("search",function(e,search){_this.setState({posts:[],offset:0,search:search},function(){_this.getPosts(null,null)})}),this.$el.on("loadnext",function(e){_this.setState({posts:[],offset:++_this.state.offset},function(){_this.getPosts()})}),this.$el.on("loadprev",function(e){_this.setState({posts:[],offset:--_this.state.offset},function(){_this.getPosts()})}),this.$el.on("loadpage",function(e,pagenum){var offset=pagenum;_this.setState({posts:[],offset:offset},function(){_this.getPosts()})}),this.$el.on("clearsearch",function(){_this.setState({posts:[],offset:0,search:""},function(){_this.getPosts()})})},parseDate:function(date,type){var m=moment(date);return"day"===type?m.format("dddd"):"date"===type?m.format("M/D/YYYY"):"time"===type?m.format("h:mm A"):void 0},parseSelectedPlatform:function(details,network){var a=_.map(details,function(d){return d.platform});return"Facebook"===network?_.contains(a,"Facebook page")||_.contains(a,"Facebook profile"):"Twitter"===network?_.contains(a,"Twitter"):"Linkedin"===network?_.contains(a,"Linkedin"):void 0},parsePostData:function(data){var _this=this,posts=[];data.forEach(function(d){var post={};post.links=[];for(var i=0;i<d.details.length;i++){var link_item={};link_item.link_platform=d.details[i].platform,link_item.link_name=d.details[i].platform_name,d.details[i].post_results&&d.details[i].post_results.response&&d.details[i].post_results.response.url?(link_item.url=d.details[i].post_results.response.url,link_item.error=""):d.details[i].post_results&&d.details[i].post_results.response&&d.details[i].post_results.response.error?(link_item.url="",link_item.error=d.details[i].post_results.response.error):(link_item.url="",link_item.error=""),post.links.push(link_item)}post.id=d.id,post.day=_this.parseDate(d.publish,"day"),post.date=_this.parseDate(d.publish,"date"),post.time=_this.parseDate(d.publish,"time"),post.message=d.details[0].message,d.details[0].image_url?post.image_url=d.details[0].image_url:d.details[0].image&&(post.image_url=_this.props.image_path+d.details[0].image),post.link_url=d.details[0].link,post.twitter_selected=_this.parseSelectedPlatform(d.details,"Twitter"),post.facebook_selected=_this.parseSelectedPlatform(d.details,"Facebook"),post.linkedin_selected=_this.parseSelectedPlatform(d.details,"linkedin"),posts.push(post)}),this.setState({posts:posts})},render:function(){var posts=[],loader=[],pagination=this.state.numposts>10&&!this.state.loading?React.createElement(Pagination,{$el:this.$el,offset:this.state.offset,numpages:Math.ceil(this.state.numposts/this.state.limit),current_page:this.state.offset+1}):null;return this.state.loading&&loader.push(React.createElement("div",{className:"m-post__loader-wrap"},React.createElement("i",{className:"m-post__loader fa fa-spinner fa-spin"}))),this.state.posts.length?this.state.posts.forEach(function(post){var details={},platforms={};details.message=post.message,details.image_url=post.image_url,details.link_url=post.link_url,details.day=post.day,details.date=post.date,details.time=post.time,platforms.twitter=post.twitter_selected,platforms.facebook=post.facebook_selected,platforms.linkedin=post.linkedin_selected,posts.push(React.createElement(Post,{post_type:"archive",post_details:details,post_platforms:platforms,key:post.id,links:post.links}))}):this.state.loading||posts.push(React.createElement("div",{className:"m-post__no-posts-msg"},React.createElement("span",null,"Hmm...nothing found. Try searching again."))),React.createElement("div",{className:"js-past-post-wrap m-post clearfix"},React.createElement("div",{className:"clearfix m-post__search-area"},React.createElement(PostSearch,{$el:this.$el})),loader,posts,pagination)}}),UpcomingPosts=React.createClass({displayName:"UpcomingPosts",componentDidMount:function(){this.listen()},getInitialState:function(){return{image_url:"",show_image_modal:!1}},listen:function(){var _this=this;$("#upcoming-posts-card").on("thumbnail-click",function(e,src){_this.setState({image_url:src,show_image_modal:!0})}),$("#upcoming-posts-card").on("closeModal",function(){_this.setState({show_image_modal:!1})})},render:function(){return React.createElement(EzModal,{el:"#upcoming-posts-card",image_url:this.state.image_url,show:this.state.show_image_modal})}}),Popover=React.createClass({displayName:"Popover",closePopover:function(){React.unmountComponentAtNode(document.getElementById("js-toolbar-settings"))},componentDidMount:function(){this.props.parent.addClass("active relative").css("z-index",99)},componentWillUnmount:function(){this.props.parent.removeClass("active relative").css("z-index",1)},render:function(){for(var close_btn=this.props.close_btn===!0?React.createElement("span",{className:"m-popover__close-btn",onClick:this.closePopover},"×"):"",items=[],i=0;i<this.props.items.length;i++){var onclick=this.props.items[i].onclick,icon=this.props.items[i].icon,icon_classname="fa fa-"+icon;onclick?items.push(React.createElement("li",{className:"m-popover__item"},React.createElement("i",{className:icon_classname}),React.createElement("span",{onClick:this.props.items[i].onclick},this.props.items[i].text))):items.push(React.createElement("li",{className:"m-popover__item"},React.createElement("i",{className:icon_classname}),React.createElement("a",{href:this.props.items[i].link},this.props.items[i].text)))}return React.createElement("div",{className:"m-popover"},React.createElement("div",{className:"m-popover__header"},React.createElement("span",{className:"m-popover__header-text"},this.props.header),close_btn),React.createElement("div",{className:"m-popover__content"},React.createElement("ul",{className:"m-popover__list"},items)))}}),Composebox=React.createClass({displayName:"Composebox",componentDidMount:function(){this.$el=$(".js-composebox"),this.listen();var is_mobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(navigator.userAgent);this.is_chrome=!is_mobile&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)},getInitialState:function(){return{posts:[],active_acct:"",post_id:"",current_message:"",image_url:"",link_url:"",delete_gpost_id:"",message_length:140,all_selected:!0,details:[],avatars:[],show_main_screen:!0,show_avatar_screen:!1,current_avatar:0,default_message:"",show_datepicker:!1,datetime:moment(),composebox_enabled:!1,progress_bar_visible:!1,progress_value:0,progress_max:0,show_image_modal:!1,post_pending:!1}},render:function(){var _this=this,avatars=[],image_url="",progress_bar=_this.state.progress_bar_visible?React.createElement("progress",{value:_this.state.progress_value,max:_this.state.progress_max}):null,thumb_color="selected orange",show_main_screen=this.state.show_main_screen?"":"hidden",show_avatar_screen=this.state.show_avatar_screen?"":"hidden",avatar_width=52,num_avatars=0,overflow="",showhide_native_datepicker=_this.state.show_datepicker&&Modernizr.inputtypes.date&&Modernizr.inputtypes.time&&!_this.is_chrome?"":"hidden",showhide_browser_datepicker=_this.state.show_datepicker&&!Modernizr.inputtypes.date||_this.state.show_datepicker&&_this.is_chrome?"":"hidden",account_name="",account_icon="",details_wrap_style={},edit_mode=""!==_this.state.post_id?!0:!1,title=edit_mode?"Edit Post":"Create Post",close_btn=this.props.close_btn?React.createElement("span",{className:"m-composebox__close-btn",onClick:this.hide},"×"):null,post_btn=_this.state.composebox_enabled?React.createElement("i",{className:"m-composebox__post-btn fa fa-send-o",onClick:_this.post}):React.createElement("i",{className:"m-composebox__post-btn fa fa-send-o disabled"}),time=_this.state.datetime.fromNow();time=-1===time.indexOf("ago")?time:"Post Now";var message=_this.state.default_message,message_length=_this.state.default_message.length,link="",selected_accounts=[];this.state.posts.forEach(function(post,index){post.image_url&&(image_url=post.image_url),link=""!==post.link?post.link:link,post.platform_id===_this.state.active_acct&&post.custom_message&&(message=post.message,message_length=post.message.length);var avatar_url="";_.find(_this.props.user.social_accounts,function(acct){acct.platform_id===post.platform_id&&(avatar_url=acct.avatar_url)});var avatar_selected=!1;post.platform_id===_this.state.active_acct&&(avatar_selected=!0,thumb_color="white",account_name=_this.getUsername(post.platform_id),account_icon=_this.getSocialIcon(post.platform_id),details_wrap_style={top:"62px"}),avatars.push(React.createElement(Avatar,{key:index,selected:avatar_selected,platform:post.platform,platform_id:post.platform_id,avatar_url:avatar_url,avatar_click:_this.handleAvatarClick})),selected_accounts.push(post.platform_id),num_avatars++});var length_error=message_length>140?"error":"",avatar_wrap_width=avatar_width*num_avatars,image_preview_style={backgroundImage:"url("+image_url+")"},image_preview_delete=""!==image_url?React.createElement("span",{className:"m-composebox__image-preview-delete-btn",onClick:_this.handleDeleteImagePreview},"×"):null,image_preview=""!==image_url?React.createElement("div",{className:"m-composebox__image-preview",style:image_preview_style,onClick:_this.imagePreviewModal.bind(_this,image_url)}):null,ez_modal=""!==image_url&&_this.state.show_image_modal?React.createElement(EzModal,{show:!0,image_url:image_url,el:$(".js-composebox")}):React.createElement(EzModal,{show:!1,image_url:image_url});return num_avatars*avatar_width>345&&(overflow="overflow"),React.createElement("div",{className:"m-composebox js-composebox clearfix "+length_error},React.createElement("div",{className:"m-composebox__main-screen "+show_main_screen},React.createElement("div",{className:"m-composebox__header",onClick:_this.handleComposeBoxClick},React.createElement("div",{className:"m-composebox__top-row m-composebox__row"},close_btn,React.createElement("span",{className:"m-composebox__heading"},title),post_btn),React.createElement("div",{className:"m-composebox__avatar-row m-composebox__row"},React.createElement("i",{className:thumb_color+" likeable-thumb-svg m-avatar m-composebox__all-btn ",onClick:_this.clickAllSelected}),React.createElement("div",{className:"m-composebox__avatar-container "+overflow},React.createElement("div",{className:"m-composebox__avatar-wrap",style:{width:avatar_wrap_width}},avatars)),React.createElement("span",{className:"m-avatar m-composebox__add-btn",onClick:this.handleAddBtnClick},"+"))),React.createElement("div",{className:"m-composebox__post-wrap m-composebox__row",onClick:_this.handleComposeBoxClick},progress_bar,React.createElement("textarea",{disabled:_this.state.post_pending?"disabled":"",placeholder:"Tell a story...",value:message+link,onChange:this.updateMessage}),_this.state.post_pending?React.createElement("div",{className:"m-composebox__spinner-wrap"},React.createElement("div",{className:"m-spinner"})):null),React.createElement("div",{className:"m-composebox__details-row m-composebox__row",onClick:_this.handleComposeBoxClick},React.createElement("div",{className:"m-composebox__details-wrap",style:details_wrap_style},React.createElement("span",{className:"m-composebox__char-count m-composebox__detail"},React.createElement("i",{className:"fa fa-comment"}),message_length),React.createElement("span",{className:"m-composebox__detail"},React.createElement("i",{className:"fa fa-calendar"}),time),React.createElement("span",{className:"m-composebox__detail"},account_icon,account_name)),React.createElement("div",{className:"m-composebox__image-preview-wrap"},image_preview_delete,image_preview,ez_modal)),React.createElement("div",{className:"m-composebox__button-row m-composebox__row row"},React.createElement("form",{enctype:"multipart/form-data",className:"m-imageupload col-1-4 static",id:"the-form",ref:"image_upload_form",name:"image_upload_form"},React.createElement("div",{className:"m-imageupload__wrap center"},React.createElement("span",{className:"m-imageupload__icon"},React.createElement("i",{className:"fa fa-camera"})),React.createElement("input",{className:"m-imageupload__input",type:"file",onChange:this.uploadPic,accept:"image/*;capture=camera",name:"image_upload"}))),React.createElement("div",{className:"col-1-4 static"}," "),React.createElement("div",{className:"col-1-4 static"}," "),React.createElement("div",{className:"col-1-4 static"},React.createElement("i",{id:"js-datepicker-trigger",className:"fa fa-calendar m-composebox__datepicker-icon center",onClick:this.handleCalendarClick}),React.createElement(DateTimePicker,{showhide_native:showhide_native_datepicker,moment:_this.state.datetime,showhide_browser:showhide_browser_datepicker})))),React.createElement(AccountsScreen,{num_avatars:num_avatars,edit_mode:edit_mode,selected:selected_accounts,posts:this.state.posts,avatar_wrap_width:avatar_wrap_width,show:show_avatar_screen,avatars:avatars,accounts:this.props.user.social_accounts,close:_this.closeAccountsScreen}))},ideaPost:function(message,image_url,link_url){image_url="undefined"==typeof image_url?"":image_url,link_url="undefined"==typeof link_url?"":link_url;var _this=this,posts=[],default_message=message;this.props.user.social_accounts.length&&this.props.user.social_accounts.forEach(function(acct){function makePost(){acct.selected&&posts.push({platform:acct.platform,platform_id:acct.platform_id,platform_name:acct.username,message:message,image_url:image_url,
link:link_url,custom_message:!1,default_message:!0})}link_url?$.ajax({url:"/parse_website.json?link="+link_url,success:function(data){image_url=data.data.image,makePost()},error:function(){}}):makePost()}),this.setState({composebox_enabled:!0,default_message:default_message,posts:posts},function(){_this.show()})},editPost:function(details,id,date){var _this=this,posts=[],default_message="",datetime=moment(date);details=decodeURIComponent(details),details=JSON.parse(details),details.hasOwnProperty("default_message")||(default_message=details[0].message),details.forEach(function(post){post.default_message&&(default_message=post.message),posts.push({platform:post.platform,platform_id:post.platform_id,platform_name:post.username,message:post.message,image_url:post.image_url,link:post.link,custom_message:post.custom_message,default_message:post.default_message})}),this.setState({composebox_enabled:!0,default_message:default_message,post_id:id,posts:posts,datetime:datetime},function(){_this.show()})},newPost:function(){var _this=this,posts=[];this.props.user.social_accounts.length&&this.props.user.social_accounts.forEach(function(acct){acct.selected&&posts.push({platform:acct.platform,platform_id:acct.platform_id,platform_name:acct.username,message:"",image_url:"",link:"",custom_message:!1,default_message:!0})}),this.setState({posts:posts,post_id:"",default_message:"",datetime:moment()},function(){_this.show()})},addAccount:function(id){var _this=this,posts=this.state.posts,post={};_.find(_this.props.user.social_accounts,function(acct){acct.platform_id===id&&(post.platform=acct.platform,post.platform_id=acct.platform_id,post.platform_name=acct.username,post.message=_this.state.default_message,post.image_url=_this.state.image_url,post.link=_this.state.link_url,post.custom_message=!1,post.default_message=!0)}),posts.push(post),_this.setState({posts:posts})},clickAllSelected:function(){this.setState({all_selected:!0,active_acct:"",current_message:this.state.default_message})},closeAccountsScreen:function(){this.setState({show_avatar_screen:!1,show_main_screen:!0})},getUsername:function(id){var username="Default";return this.props.user.social_accounts.forEach(function(acct){acct.platform_id===id&&(username=acct.username)}),username},getSocialIcon:function(id){var icon="",platform="";return this.props.user.social_accounts.forEach(function(acct){acct.platform_id===id&&(platform=acct.platform)}),-1!==platform.indexOf("Facebook")?icon=React.createElement("i",{className:"fa fa-facebook"}):-1!==platform.indexOf("Linked")?icon=React.createElement("i",{className:"fa fa-linkedin"}):-1!==platform.indexOf("Twitter")&&(icon=React.createElement("i",{className:"fa fa-twitter"})),icon},handleAddBtnClick:function(){this.setState({show_avatar_screen:!0,show_main_screen:!1})},handleCalendarClick:function(){this.setState({show_datepicker:!this.state.show_datepicker})},handleComposeBoxClick:function(){this.setState({show_datepicker:!1})},handleDeleteImagePreview:function(){var posts=this.state.posts;posts.forEach(function(post){post.image_url=""}),this.setState({posts:posts})},handleUploadProgress:function(e){e.lengthComputable&&this.setState({progress_value:e.loaded,progress_max:e.total})},hide:function(){this.$el.hide(),$("#js-toolbar__composebox-btn").removeClass("active relative"),$(".m-modal").hide(),$("html").css("overflow","visible")},imagePreviewModal:function(image_url){this.setState({show_image_modal:!0})},listen:function(){var _this=this;$("body").on("showComposeBox",function(){_this.show()}),$("body").on("hideComposeBox",function(){_this.hide()}),_this.$el.on("addAccount",function(e,id){_this.addAccount(id)}),_this.$el.on("removeAccount",function(e,id){_this.state.posts.length>1&&_this.removeAccount(id)}),$("body").on("toggleDatepicker",function(){_this.setState({show_datepicker:!_this.state.show_datepicker})}),$("body").on("dateChange",function(e,moment){_this.setState({datetime:moment})}),$("body").on("editPost",function(e,details,id,date){_this.editPost(details,id,date)}),$("body").on("newPost",function(){_this.newPost()}),$("body").on("ideaPost",function(e,message,image_url,link_url){_this.ideaPost(message,image_url,link_url)}),$("body").on("setActiveAcct",function(e,platform_id){_this.setState({active_acct:platform_id})}),$(".js-composebox").on("closeModal",function(){_this.setState({show_image_modal:!1})})},post:function(){var _this=this;_this.setState({composebox_enabled:!1,post_pending:!0}),$.ajax({url:"/post",type:"POST",data:JSON.stringify({details:JSON.stringify(_this.state.posts),delete_gpost_id:"0",post_id:_this.state.post_id,publish_date_readable:_this.state.datetime.format(),publish_timestamp:1e3*_this.state.datetime.unix()}),contentType:"application/json",success:function(){window.location="/"},error:function(){_this.setState({composebox_enabled:!0,post_pending:!1})}})},removeAccount:function(id){var _this=this,posts=[];posts=_.filter(this.state.posts,function(post){return id!==post.platform_id}),_this.setState({posts:posts})},show:function(){this.$el.show(),$("#js-toolbar__composebox-btn").addClass("active relative"),$(".m-modal").show(),$("html").css("overflow","hidden")},updateMessage:function(e){var _this=this,composebox_enabled=e.target.value.length>0?!0:!1;""!==_this.state.active_acct?_this.setCustomPost(_this.state.active_acct,e.target.value):_this.updateDefaultMessage(e.target.value),_this.setState({composebox_enabled:composebox_enabled,current_message:e.target.value})},setCustomPost:function(acct_id,message){var posts=this.state.posts;posts.forEach(function(post){post.platform_id===acct_id&&(post.message=message,post.custom_message=!0,post.default_message=!1)}),this.setState({posts:posts})},updateDefaultMessage:function(message){var posts=this.state.posts;posts.forEach(function(post){post.custom_message||(post.message=message,post.default_message=!0)}),this.setState({posts:posts,default_message:message})},image_upload_busy:!1,uploadPic:function(e){e.preventDefault();var _this=this,form=React.findDOMNode(this.refs.image_upload_form),formData=new FormData(form);_this.image_upload_busy=!0,_this.setState({progress_bar_visible:!0}),$.ajax({url:"/image_upload",type:"POST",xhr:function(){var myXhr=$.ajaxSettings.xhr();return myXhr.upload&&myXhr.upload.addEventListener("progress",_this.handleUploadProgress,!1),myXhr},success:function(data){var posts=_this.state.posts;posts.forEach(function(post){post.image_url=data.url}),_this.image_upload_busy=!1,_this.setState({progress_bar_visible:!1,progress_value:0,posts:posts})},error:function(){_this.image_upload_busy=!1,_this.setState({progress_bar_visible:!1,progress_value:0}),alertError("Upload failed")},data:formData,cache:!1,contentType:!1,processData:!1})}});